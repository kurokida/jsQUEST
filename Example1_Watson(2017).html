<!DOCTYPE html>
<html>
    <head>
        <script src="https://www.hes.kyushu-u.ac.jp/~kurokid/QUEST/dist/jsQUEST.js"></script>
        <script src="./numeric.js"></script>
        <script src="src/jsQuestPlus.js"></script>
    </head>
<body>
    <p>This program simulates the QUEST method: a Bayesian adaptive psychometric method (<a href="https://link.springer.com/article/10.3758/BF03202828">Watson & Pelli, 1983</a>).</p>
    <p>This program is a rewrite of <a href="http://psychtoolbox.org/docs/QuestDemo">QuestDemo</a>, which is distributed as a part of <a href="http://psychtoolbox.org/">Psychtoolbox</a>, using <a href= "https://www.jspsych.org/">jsPsych</a> and <a href="https://github.com/kurokida/jsQUEST">jsQUEST</a>.</p>
    <p>Please open the JavaScript console window in your browser. If you are using Chrome on Windows, press Ctrl + Shift + I to open the console.</p>
</body>
<script>
    // Psychometric function corresponding to the first response
    // This is the same as jsquest.weibull
    function func_resp0(stim, threshold, slope, guess, lapse) {
        const tmp = slope * (stim - threshold)/20
        return lapse - (guess + lapse -1)*Math.exp(-Math.pow(10, tmp))
    }

    function func_resp1(stim, threshold, slope, guess, lapse) {
        return 1 - func_resp0(stim, threshold, slope, guess, lapse) 
    }

    const stimDomain = numeric.linspace(-40, 0)
    const threshold_domain = numeric.linspace(-40,0)
    const slope_domain = [3.5]
    const guess_domain = [0.5]
    const lapse_domain = [0.02]

    const qp1 = new jsquest(
        [func_resp0, func_resp1], [stimDomain], [threshold_domain, slope_domain, guess_domain, lapse_domain], [0,1])

    const nTrials = 32;
    const true_threshold = -20
    const true_slope = 3.5
    const true_guess = 0.5
    const true_lapse = 0.02

    for (let i = 0; i < nTrials; i++){
        const intensity = qp1.getTargetStim()
        const resp = jsquest.simulate_weibull_two_resp(intensity, true_threshold, true_slope, true_guess, true_lapse)
        console.log(`Trial${i+1}: Intensity = ${intensity}; Response = ${resp}`)
        qp1.update(intensity, resp)    
    }

    console.log(qp1.getPara())

</script>
</html>
